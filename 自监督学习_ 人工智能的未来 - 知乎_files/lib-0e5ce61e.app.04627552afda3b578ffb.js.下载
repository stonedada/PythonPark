"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[887],{52627:function(t,e,n){n.d(e,{As:function(){return Ce},BU:function(){return Me},EN:function(){return me},Ho:function(){return He},RK:function(){return De},RP:function(){return Ee},S_:function(){return he},TS:function(){return ee},Zd:function(){return Qe},cx:function(){return $t},fN:function(){return Xt},p1:function(){return Jt},pE:function(){return _e},rI:function(){return je}});var o,r=n(5241),a=n.n(r),i=n(67541),c=n.n(i),l=n(20315),s=n.n(l),u=n(23061),d=n.n(u),f=n(67051),g=n.n(f),h=n(63170),m=n.n(h),p=n(46246),v=n.n(p),b=n(99712),A=n.n(b),k=n(6885),y=n.n(k),w=n(87363),C=n(58386),x=n.n(C),B=n(17222),L=(n(77638),n(48457)),z=n(47859),G=n(69975),S=n(64102),Z=n(68562),O=n(75926),R=n.n(O),j=n(47112),I=n.n(j),T=n(86193),W=n(37831),E=n(72928),D=n.n(E),N=n(48340),P=n(12856),K=n(26111),M=n.n(K),_=n(70164),V=n(36014),q=n(49595),U=n(38301),H=n.n(U),Q=n(55270),F=n(76745),X=n.n(F),Y=n(91840),J=n(61533),$=n(11116),tt=n(40491),et=n.n(tt),nt=n(53719),ot=n(37015),rt=n(14910),at=n(1319),it=["as","tag","className","html","clearBoth","richContentKey","root","Portal","useHooks"],ct=["text","target","url","image","imageWidth","imageHeight","component","className","size","children"],lt=["inEditor","data-text","href","zaBlock"],st=["root"],ut=["node","tagName"],dt=["src","useWebP","useMp4","onRef","onLoadStateChange"],ft=["html","css","options","ConditionalImage","linkCardInfo"],gt=["lazyLoadImageOptions","useGifPortalOption"];function ht(t,e,n){if(e&&!Array.isArray(e)&&"number"==typeof e.length){var o=e.length;return function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}(e,void 0!==n&&n<o?n:o)}return t(e,n)}var mt=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){e.forEach((function(e){"function"==typeof e?e(t):e&&(e.current=t)}))}};function pt(t){var e=this;return t.length?function(n,o){for(var r=t.length-1,a=n;r>=0;)a=t[r].call(e,a,o),r--;return a}:x()}var vt="function"==typeof queueMicrotask?queueMicrotask:function(t){return Promise.resolve().then(t)},bt=function(t){var e=(0,w.useRef)(null);(0,w.useEffect)((function(){if(t)return vt((function(){t&&(e.current=function(t){var e=new IntersectionObserver((function(t){t.forEach(n)}),{threshold:[.1]});function n(t){if(0!==t.intersectionRatio){var n=t.target;n.dataset.zaDetailViewId=n.cardShowViewId,B.Z.trackCardShow(n,{},{link:{url:n.href}}),e.unobserve(n),n.clickViewId&&(n.dataset.zaDetailViewId=n.clickViewId)}}return[{cardShowViewId:1042,clickViewId:1043,selector:"a.external, a.internal"},{cardShowViewId:1044,clickViewId:1045,selector:"a.member_mention, a.UserLink-link"},{cardShowViewId:174,clickViewId:175,selector:"a.video-box"},{cardShowViewId:171,clickViewId:172,selector:'a[data-draft-type="link-card"]'},{cardShowViewId:7692,selector:"a.FileLinkCard .FileLinkCard-info"},{cardShowViewId:9744,selector:".Catalog"}].forEach((function(n){var o=n.selector,r=n.cardShowViewId,a=n.clickViewId;Array.from(t.querySelectorAll(o)).forEach((function(t){t.cardShowViewId=r,t.clickViewId=a,e.observe(t)}))})),function(){e.disconnect()}}(t))})),function(){e.current&&e.current()}}),[t])},At=function(t){return{elementLocation:{type:"Button",content:{type:t.dataset.zaContentType}}}},kt=function(t){return{attachedInfoBytes:t.dataset.zaAttachInfo}},yt=[{selector:"a.external, a.internal",zaBlock:"ZTextLink"},{selector:"a.member_mention, a.UserLink-link",zaBlock:"ZTextMention"},{selector:"a.video-box",zaBlock:"ZTextVideoCard"},{selector:'a.LinkCard.old[data-draft-type="link-card"]',zaBlock:"ZTextLinkCard"},{selector:'a.LinkCard.new.static[data-draft-type="link-card"]:not([data-za-content-type="Zvideo"])',zaBlock:"ZTextLinkCard",viewInfoBuilder:At,extraInfoBuilder:kt},{selector:'a.LinkCard.new.static[data-draft-type="link-card"][data-za-content-type="Zvideo"]',zaBlock:"ZTextZVideoLinkCard",viewInfoBuilder:At,extraInfoBuilder:kt},{selector:"a.FileLinkCard",zaBlock:"ZTextFileLinkCard"}],wt=function(t){var e,n,o=t.element,r=t.config,a=null===(e=r.viewInfoBuilder)||void 0===e?void 0:e.call(r,o,r),i=Object.assign({elementLocation:{type:"Button"},block:r.zaBlock},a),c=Object.assign({action:"OpenUrl",elementLocation:{type:"Button"},block:r.zaBlock,eventType:"Click"},a),l=Object.assign({link:{url:o.href}},null===(n=r.extraInfoBuilder)||void 0===n?void 0:n.call(r,o,r)),s=(0,L.Q4)().trackEvent,u=(0,L.x3)(i,l),d=(0,z.Z)((function(t){s(c,l),"ZTextLinkCard"===r.zaBlock&&o.dataset.isEcommerce&&t.preventDefault()}));return(0,w.useEffect)((function(){return o.addEventListener("click",d),function(){o.removeEventListener("click",d)}}),[]),(0,w.useEffect)((function(){return u(o),function(){return u(null)}}),[]),null},Ct=function(t){var e=t.root,n=(0,w.useState)([]),o=ht(y(),n,2),r=o[0],a=o[1];return(0,w.useEffect)((function(){if(e){var t=[];yt.forEach((function(n){var o=n.selector;Array.from(e.querySelectorAll(o)).forEach((function(e){t.push({el:e,config:n})}))})),a(t)}}),[e]),(0,Z.tZ)(w.Fragment,{children:r.map((function(t,e){var n=t.el,o=t.config;return(0,Z.tZ)(wt,{element:n,config:o},e)}))})},xt=/<p><br><\/p>/g,Bt=/<[^<>\s]+(\s|>)/,Lt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solid";return{borderBottom:"1px ".concat(e," ").concat(t.colors.GBK05A)}},zt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solid";return{borderBottom:"1px ".concat(e," ").concat(t.colors.GBL07A)}},Gt=function(t){return{color:t.colors.GBL07A,"&:hover":zt(t)}},St=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[data-focus-visible]";return A()({outline:"none",transition:"box-shadow 0.3s"},"html".concat(e," &"),{boxShadow:"0 0 0 2px ".concat(t.colors.GBK99A,", 0 0 0 4px ").concat(t.colorMod(t.colors.GBL01A).alpha(.3))})},Zt=(0,T.F4)(o||(o=v()(["\n   from { opacity: 0; }\n   to { opacity: 1; }\n"]))),Ot=function(t){var e="1.4em";return Object.assign({wordBreak:"break-word",lineHeight:"1.6","> [data-first-child]":{marginTop:0},"> :last-child":{marginBottom:0},"h1,h2":{clear:"left",marginTop:"calc((".concat(e," * 2) / 1.2)"),marginBottom:"calc(".concat(e," / 1.2)"),fontSize:"1.2em",lineHeight:1.5,fontWeight:t.fontWeights.bold},"h3,h4,h5,h6":{clear:"left",marginTop:"calc((".concat(e," * 1.5) / 1.1)"),marginBottom:"calc(".concat(e," / 1.1)"),fontSize:"1.1em",lineHeight:"1.5",fontWeight:t.fontWeights.bold},u:{textDecoration:"none",borderBottom:"1px solid ".concat(t.colors.GBK03A)},b:{fontWeight:t.fontWeights.bold},sup:{fontSize:"0.8em"},"sup[data-draft-type='reference']":{color:t.colors.GBL07A},"a:focus":St(t),"a.ztext-link,a.internal,a.external":Object.assign(Object.assign({textDecoration:"none",cursor:"pointer"},Lt(t)),{},{"&:hover":Object.assign({color:t.colors.GBL07A},zt(t))," > .ellipsis::after":{content:"'...'"},"> .invisible":{font:"0/0 a",color:"transparent",textShadow:"none",backgroundColor:"transparent"},u:{border:"none"}}),"a.member_mention":Gt(t),"a.UserLink-link":Gt(t),p:{margin:"".concat(e," 0")},"p.ztext-empty-paragraph":{margin:"calc((".concat("2.8em","- (").concat(e," * 2 + 1.6em)) / 2) 0"),"+ .ztext-empty-paragraph":{margin:"".concat(e," 0")}},hr:{margin:"4em auto",width:"240px",maxWidth:"100%",border:"none",borderTop:"1px solid ".concat(t.colors.GBK08A)},"img[eeimg]":Object.assign({maxWidth:"100%",verticalAlign:"middle"},t.isDarkMod&&{filter:"invert(1)"}),'img[eeimg="1"]':{margin:"0 3px",maxWidth:"calc(100% - 6px)",display:"inline-block"},'img[eeimg="2"]':{margin:"".concat(e," auto"),display:"block"},blockquote:{margin:"".concat(e," 0"),paddingLeft:"1em",color:t.colors.GBK04A,borderLeft:"3px solid ".concat(t.colors.GBK08A)},"ol,ul":{margin:"".concat(e," 0"),padding:0,width:"100%","ol,ul":{margin:0},"li::before":{width:"1em"},"> ol, > ul":{display:"table-row","&::before":{display:"table-cell",content:"''"}}},ul:{display:"table","&>li":{display:"table-row",listStyle:"none","&::before":{display:"table-cell",content:"'•  '",whiteSpace:"pre"}}},ol:{display:"table",counterReset:"ol","> li":{display:"table-row",listStyle:"none","&::before":{display:"table-cell",textAlign:"right",counterIncrement:"ol",content:"counter(ol) '. '",whiteSpace:"pre"}}},"ol ol":{counterReset:"ol2","li::before":{counterIncrement:"ol2",content:"counter(ol2) '. '"}},"ol ol ol":{counterReset:"ol3","li::before":{counterIncrement:"ol3",content:"counter(ol3) '. '"}},"ol ol ol ol":{counterReset:"ol4","li::before":{counterIncrement:"ol4",content:"counter(ol4) '. '"}},figure:{margin:"".concat(e," 0"),".content_image,.origin_image":{margin:"0 auto"},figcaption:{marginTop:"calc(0.6em / 0.9)",padding:"0 1em",fontSize:"0.9em",lineHeight:"1.5",textAlign:"center",color:t.colors.GBK06A},"& + figure":{marginTop:"calc(".concat(e," * 1.6)")},"&[data-size='small'],&:not([data-size]) > [data-size='small']":{clear:"both"},"&[data-size='left'],&:not([data-size]) > [data-size='left']":{float:"left",margin:"0 20px 20px 0",maxWidth:"33%"},"&[data-size='right'],&:not([data-size]) > [data-size='right']":{float:"right",margin:"0 0 20px 20px",maxWidth:"33%"},"&[data-size='collapse']":{marginBottom:0,"& + figure":{marginTop:0}}},".content_image, .origin_image":{display:"block",maxWidth:"100%",height:"auto",margin:"".concat(e," auto"),"&[data-size='small']":{maxWidth:"40%"},"&.zh-lightbox-thumb":{cursor:"zoom-in"}},code:{margin:"0 2px",padding:"3px 4px",borderRadius:"3px",fontFamily:t.fonts.monospace,fontSize:"0.9em",backgroundColor:t.colors.GBK10A},pre:{margin:"".concat(e," 0"),padding:"calc(0.8em / 0.9)",fontSize:"0.9em",wordBreak:"initial",wordWrap:"initial",whiteSpace:"pre",overflow:"auto",WebkitOverflowScrolling:"touch",background:t.colors.GBK10A,borderRadius:"4px",code:{margin:0,padding:0,fontSize:"inherit",borderRadius:0,backgroundColor:"inherit"}},"li pre":{whiteSpace:"pre-wrap"},"table[data-draft-type='table']":{borderCollapse:"collapse",fontSize:"15px",margin:"".concat(e," auto"),maxWidth:"100%",tableLayout:"fixed",textAlign:"left",width:"100%","&[data-size='small']":{minWidth:"260px",width:"40%"},"&[data-row-style='striped'] tr:nth-of-type(2n + 1)":{background:t.colors.GBK10A},"td,th":{border:"1px solid ".concat(t.colors.GBK08A),lineHeight:"24px",height:"24px",padding:"3px 12px"},th:{background:t.colors.GBK09A,color:t.colors.GBK02A,fontWeight:500}},"& .video-box, & .link-box":{position:"relative",display:"flex",justifyContent:"space-between",margin:"".concat(e," 0"),overflow:"auto",whiteSpace:"normal",cursor:"pointer",border:"solid 1px ".concat(t.colors.GBK09A),borderRadius:"4px"}},function(t){return{".lazy[data-lazy-status]":{backgroundColor:t.colors.GBK10A},'.lazy[data-lazy-status="ok"]':{backgroundColor:"transparent",animation:"".concat(Zt," 0.5s ease-in")}}}(t))},Rt=[function(t){return t?t.replace(xt,'<p class="ztext-empty-paragraph"><br /></p>'):t},function(t){return t?t.replace(Bt,(function(t,e){return t.replace(e," data-first-child".concat(e))})):t}],jt=(0,w.forwardRef)((function(t,e){var n,o=t.as,r=t.tag,a=t.className,i=t.html,c=t.clearBoth,l=void 0!==c&&c,s=t.richContentKey,u=t.root,d=t.Portal,f=t.useHooks,g=m()(t,it),h=pt(Rt);f(u);var p=null!==(n=null!=o?o:r)&&void 0!==n?n:"div";return(0,Z.BX)(Z.HY,{children:[d&&(0,Z.tZ)(d,{root:u}),(0,Z.tZ)(p,Object.assign({ref:e,css:function(t){return Object.assign(Object.assign(Object.assign({},Ot(t)),function(t){return{"& .highlight":{margin:"1em 0",pre:{margin:0},".hll":{backgroundColor:t.colors.GBK12A},".c":{fontStyle:"italic",color:t.colors.GBK06A},".err":{color:t.colors.GRD03A},".k":{fontWeight:t.fontWeights.bold},".o":{fontWeight:t.fontWeights.bold},".cm":{fontStyle:"italic",color:t.colors.GBK06A},".cp":{fontWeight:t.fontWeights.bold,color:t.colors.GBK06A},".c1":{fontStyle:"italic",color:t.colors.GBK06A},".cs":{fontStyle:"italic",fontWeight:t.fontWeights.bold,color:t.colors.GBK06A},".gd":{color:t.colors.GRD01A},".ge":{fontStyle:"italic"},".gr":{color:t.colors.GRD03A},".gh":{color:t.colors.GBK06A},".gi":{color:"#12b370"},".go":{color:t.colors.GBK05A},".gp":{color:t.colors.GBK04A},".gs":{fontWeight:t.fontWeights.bold},".gu":{color:t.colors.GBK06A},".gt":{color:t.colors.GRD03A},".kc":{fontWeight:t.fontWeights.bold},".kd":{fontWeight:t.fontWeights.bold},".kn":{fontWeight:t.fontWeights.bold},".kp":{fontWeight:t.fontWeights.bold},".kr":{fontWeight:t.fontWeights.bold},".kt":{fontWeight:t.fontWeights.bold,color:t.colors.GBL07A},".m":{color:t.colors.GBL01A},".s":{color:t.colors.GRD03A},".na":{color:t.colors.GBL01A},".nb":{color:t.colors.GBL01A},".nc":{fontWeight:t.fontWeights.bold,color:t.colors.GBL07A},".no":{color:t.colors.GBL01A},".ni":{color:t.colors.GRD07A},".ne":{fontWeight:t.fontWeights.bold,color:t.colors.GRD03A},".nf":{fontWeight:t.fontWeights.bold,color:t.colors.GRD03A},".nn":{color:t.colors.GBK04A},".nt":{color:t.colors.GBL07A},".nv":{color:t.colors.GBL01A},".ow":{fontWeight:t.fontWeights.bold},".w":{color:t.colors.GBK07A},".mf":{color:t.colors.GBL01A},".mh":{color:t.colors.GBL01A},".mi":{color:t.colors.GBL01A},".mo":{color:t.colors.GBL01A},".sb":{color:t.colors.GRD03A},".sc":{color:t.colors.GRD03A},".sd":{color:t.colors.GRD03A},".s2":{color:t.colors.GRD03A},".se":{color:t.colors.GRD03A},".sh":{color:t.colors.GRD03A},".si":{color:t.colors.GRD03A},".sx":{color:t.colors.GRD03A},".sr":{color:t.colors.GYL02A},".s1":{color:t.colors.GRD03A},".ss":{color:t.colors.GRD03A},".bp":{color:t.colors.GBK06A},".vc":{color:t.colors.GBL01A},".vg":{color:t.colors.GBL01A},".vi":{color:t.colors.GBL01A},".il":{color:t.colors.GBL01A},"&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-thumb:horizontal":{backgroundColor:t.colorMod(t.colors.GBK02A).alpha(.5),borderRadius:"6px","&:hover":{backgroundColor:t.colorMod(t.colors.GBK02A).alpha(.6)}}}}}(t)),l&&{"&::before, &::after":{clear:"both",content:'""',display:"block"}})},className:I()("RichText","ztext",a,{"RichText--clearBoth":l}),dangerouslySetInnerHTML:{__html:h(i)}},g),s||i)]})}));jt.propTypes={as:R().string,tag:R().string,html:R().string.isRequired,clearBoth:R().bool,ref:R().func,Portal:R().func,useHooks:R().func},jt.defaultProps={useHooks:x()};var It=(0,w.memo)(jt),Tt=(0,w.forwardRef)((function(t,e){var n=D()(t,["entityType","entityData","notCommerce"]),o=n.text,r=n.target,a=n.url,i=n.image,c=n.imageWidth,l=n.imageHeight,s=n.component,u=n.className,d=n.size,f=n.children,g=m()(n,ct),h=function(t,e){if(t>0&&e>0){var n=t/e;if(n>1.2)return"180x120";if(n<=.8)return"120x160"}return"ipico"}(c,l),p=(0,N.imgUrl)(i,h);return(0,Z.tZ)(s,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({ref:e,target:r,href:a,"data-draft-node":"block","data-draft-type":"link-card"},p&&{"data-image":p}),c&&{"data-image-width":c}),l&&{"data-image-height":l}),d&&{"data-size":d}),o!==a&&o&&{"data-text":o}),{},{className:I()("LinkCard new",u)},g),{},{children:f||(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("span",{className:"LinkCard-contents",children:[(0,Z.tZ)("span",{className:"LinkCard-title loading","data-text":!0}),(0,Z.tZ)("span",{className:"LinkCard-desc loading"})]}),(0,Z.tZ)("span",{className:"LinkCard-image LinkCard-image--default"})]})}))}));Tt.propTypes={component:R().oneOfType([R().string,R().func]),target:R().string,url:R().string.isRequired,text:R().string,image:R().string,imageWidth:R().oneOfType([R().string,R().number]),imageHeight:R().oneOfType([R().string,R().number])},Tt.defaultProps={component:"a",target:"_blank"};var Wt={answer:"回答",article:"文章",zvideo:"视频",question:"问题",collection:"收藏夹",roundtable:"圆桌",topic:"话题"},Et={voteupCount:"赞同",commentCount:"评论",playCount:"播放",followerCount:"关注",answerCount:"回答",visitCount:"浏览",discussionCount:"讨论"},Dt={answer:["voteupCount","commentCount"],article:["voteupCount","commentCount"],zvideo:["playCount","voteupCount"],question:["followerCount","answerCount"],collection:["visitCount","followerCount"],topic:["visitCount","discussionCount"],default:["followerCount","visitCount"]},Nt=function(t){var e=t.twoLine,n=t.children;return Boolean(n)&&(0,Z.tZ)("span",{className:I()("LinkCard-title",{"two-line":e}),children:n})},Pt=function(t){var e=t.data,n=e.objectType,o=(Dt[n]||Dt.default).map((function(t){var n=e[t];return"".concat((0,_.Zh)(n)).concat(Et[t])})).filter(Boolean).join(" · ");return(0,Z.BX)("span",{className:"LinkCard-desc",children:[o,(0,Z.tZ)("span",{className:"LinkCard-tag",children:Wt[n]})]})},Kt=function(t){var e=t.url,n=(0,w.useMemo)((function(){var t=null,n=M()(e,!0);return"link.zhihu.com"===n.hostname&&(t=n.query.target),(t||e).replace(/^https?:\/\//,"")}),[e]);return(0,Z.BX)("span",{className:"LinkCard-desc",children:[(0,Z.tZ)(V.n,{size:14,center:!0}),n]})},Mt=function(t){var e=t.url,n=t.isVideo,o=t.ratio,r=void 0===o?1:o,a=t.onClick;return Boolean(e)&&(0,Z.BX)("span",{className:"LinkCard-image",style:{height:60*r},children:[(0,Z.tZ)("img",{src:e,onClick:a,alt:n?"点击可播放视频":""}),n&&(0,Z.tZ)("span",{className:"LinkCard-image--video",children:(0,Z.tZ)(q.D,{size:10,center:!0})})]})},_t=function(t,e){var n=t.url,o=t.data,r=t.onClick,a=t.onClickImage,i=o.title,c=o.thumbnail,l=o.objectType;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("span",{ref:e,className:"LinkCard-contents",onClick:r,children:[(0,Z.tZ)(Nt,{twoLine:!0,children:i}),l?(0,Z.tZ)(Pt,{data:o}):(0,Z.tZ)(Kt,{url:n})]}),(0,Z.tZ)(Mt,{url:c,isVideo:"zvideo"===l,onClick:a})]})},Vt=(0,w.forwardRef)(_t),qt=function(t){var e=t.className,n=t.html;return n?(0,Z.tZ)("span",{className:"LinkCard-richText ".concat(e),dangerouslySetInnerHTML:{__html:"<object>".concat(n,"</object>")}}):null},Ut=function(t){var e=t.data,n=e.title,o=e.desc,r=e.url,a=e.image,i=e.ratio,c=e.isVideo;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("span",{className:"LinkCard-contents",children:[(0,Z.tZ)(Nt,{twoLine:!0,children:n},"title"),(0,Z.tZ)(qt,{className:"LinkCard-desc",html:o}),!o&&(0,Z.tZ)(Kt,{url:r},"url")]}),(0,Z.tZ)(Mt,{url:a,ratio:i,isVideo:c})]})},Ht={ANSWER:"Answer",ARTICLE:"Column",ZVIDEO:"Zvideo",QUESTION:"Question",COLLECTION:"Collection",ROUNDTABLE:"Roundtable",SPECIAL:"Special",TOPIC:"Topic"},Qt=function(t){var e=(0,w.useMemo)((function(){return function(t){var e={};if(t.data){var n=(0,P.camelizeKeys)(JSON.parse(t.data)),o=n.source,r=void 0===o?{}:o,a=n.display,i=void 0===a?{}:a,c=n.zaData,l=void 0===c?{}:c,s=i.cardOpenUrl,u=i.title,d=i.content,f=i.desc,g=i.image||{};e={source:r,url:s,title:u,content:d,desc:f,image:g.imageUrl,ratio:g.ratio,isVideo:g.isVideo,zaAttachInfo:l.attachInfo}}return Object.assign(Object.assign(Object.assign({},e),t),{},{title:t.text||e.title,image:e.image||t.image})}(t)}),[t]),n=e.source,o=e.target,r=e.title,a=e.url,i=e.zaAttachInfo;return(0,Z.tZ)(Tt,{notCommerce:!0,target:o,text:r,url:a,"data-za-attach-info":i,"data-za-content-type":Ht[null==n?void 0:n.contentType]||"Unknown",className:"static",children:(0,Z.tZ)(Ut,{data:e})})},Ft=/([-\w]+)(="([^"]+)"|='([^']+)')?/g,Xt=function(t){for(var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.decodeValue,r=void 0!==o&&o,a={};e=Ft.exec(t);){var i=e[1],c=e[3]||e[4];a[i]=(r?Jt(c):c)||""}return a},Yt=function(t){if(!t)return null;try{return JSON.parse(t)}catch(t){return null}};function Jt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.replace(/&amp;/g,"&").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#34;/g,'"').replace(/&#13;/g,"\r")}function $t(){return Math.max(window.innerHeight/10,100)}var te=function(t){for(var e=t;e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&1===e.nodeType;){var n=document.defaultView.getComputedStyle(e);if([n.overflow,n.overflowY,n.overflowX].some((function(t){return"scroll"===t||"auto"===t})))return e;e=e.parentNode||e.parentElement}return window};function ee(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=te(t),r=t.getBoundingClientRect().top+(o.pageYOffset||o.scrollTop||0)-(n?$t():0)-e;o.scrollTo({top:r,behavior:"smooth"})}var ne=/<a\b([^>]*data-draft-type="link-card"[^>]*)>(.*?)<\/a>/g,oe=function(t){var e=t.target,n=t.url,o=t.component,r=t.className;return(0,Z.tZ)(o,{target:e,href:n,"data-draft-node":"block","data-draft-type":"link-card","data-is-ecommerce":"1",className:I()("LinkCard",r),children:(0,Z.BX)("span",{className:"LinkCard-content LinkCard-ecommerceLoadingCard",children:[(0,Z.tZ)("div",{className:"LinkCard-ecommerceLoadingCardAvatarWrapper",children:(0,Z.tZ)("img",{src:"https://pic2.zhimg.com/v2-1b0bbef27f0496a58468f92d94c8a80e_l.png",className:"LinkCard-ecommerceLoadingCardNetwork"})}),(0,Z.BX)("div",{className:"LinkCard-ecommerceLoadingCardLoadingbar",children:[(0,Z.tZ)("span",{}),(0,Z.tZ)("span",{})]})]})})};oe.defaultProps={component:"a",target:"_blank"};var re=/<a\b([^>]*BIZ(=|%3D)ECOMMERCE[^>]*)>(.*?)<\/a>/g;var ae=function(){function t(e){var n,o,r,a=this;d()(this,t),r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.url||(a.url=t),t!==a.url)throw new Error("mismatch url\n".concat(t,"\n").concat(a.url),t,a.url);return new Promise((function(t,n){a.addToQueue({options:e,resolve:t,reject:n})}))},(o="fetch")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.instance=null,this.customFetch=e,this.delay=200,this.maxDelay=1e3,this.url="",this.queueMaxLength=10,this.queue=[],this.startTime=Date.now(),this.timeout=null,this.initialized=!1}var e;return g()(t,[{key:"initConfig",value:function(t){var e=t.delay,n=t.maxDelay,o=t.maxBatchCount;e&&(this.delay=e),n&&(this.maxDelay=n),o&&(this.maxBatchCount=o),this.initialized=!0}},{key:"buildFetchParams",value:function(t){var e=ht(y(),t,1)[0].options,n=t.reduce((function(t,e){var n,o;return(null===(n=(o=e.options).dataBuilder)||void 0===n?void 0:n.call(o,t,e))||t}),{}),o=this.url,r=!e.method||"GET"===e.method.toUpperCase();if(r){var a=M()(o,!0);a.query=Object.assign(Object.assign({},a.query),n),o=a.toString()}return[o,Object.assign(Object.assign({},e),{},{data:r?null:Object.assign(Object.assign({},e.data),n)})]}},{key:"doFetch",value:(e=s()(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.queue.length){t.next=2;break}return t.abrupt("return");case 2:return e=this.queue,this.queue=[],t.prev=4,t.next=7,this.customFetch.apply(this,ht(c(),this.buildFetchParams(e)));case 7:n=t.sent,e.forEach((function(t){var e=t.options,o=t.resolve;e.resultBuilder?o(e.resultBuilder(n)):o(n)})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),e.forEach((function(e){return e.reject(t.t0)}));case 14:case"end":return t.stop()}}),t,this,[[4,11]])}))),function(){return e.apply(this,arguments)})},{key:"addToQueue",value:function(t){var e=this;this.initialized||this.initConfig(t.options),clearTimeout(this.timeout),(Date.now()-this.startTime>this.maxDelay||this.queue.length>=this.maxBatchCount)&&(this.startTime=Date.now(),this.doFetch()),this.queue.push(t),setTimeout((function(){e.startTime=Date.now(),e.doFetch()}),this.delay)}}]),t}(),ie=null,ce=function(){throw new Error("Not implemented")},le=function(){return function(t){return function(e,n){return ie||(ie=new ae(t)),ie.fetch(e,n)}}(function(t){return function(){var e=s()(a().mark((function e(n,o){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n,o);case 2:return r=e.sent,e.t0=P.camelizeKeys,e.next=6,r.json();case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}("undefined"!=typeof fetch?fetch:ce))},se="https://www.zhihu.com/api/v4/link_card_infos",ue=X()((function(){if(!(0,Q.isBrowser)())return se;var t=window.location,e=t.hostname,n=t.origin;return[".zpres.zhihu.dev",".zpres.zhihu.com"].some((function(t){return e.endsWith(t)}))?"".concat(n,"/api/v4/link_card_infos"):se})),de={},fe=function(t,e,n){var o=t["data-text"],r=t.href,a=t.zvideoLinkCardProps;(0,w.useEffect)((function(){n&&(0,Y.y3)(e.current,(function(){return t=e.current,void B.Z.trackCardShow(t,{id:7844},{button:{text:"inlinezvideo"}});var t}))}),[n,e]);var i=(0,z.Z)((function(t){!function(t,e,n){var o;B.Z.trackEvent(t.target,{id:7846,action:"OpenUrl"},{button:{text:"inlinezvideo"}}),null==e||null===(o=e.onImageClick)||void 0===o||o.call(e,t,n)}(t,{title:o,url:r,video:{}})})),c=(0,z.Z)((function(t){!function(t,e,n){var o;B.Z.trackEvent(t.target,{id:7846,action:"OpenUrl"},{button:{text:"inlinezvideo"}}),null==e||null===(o=e.onImageClick)||void 0===o||o.call(e,t,n)}(t,a,{title:o,url:r})}));return n?{handleImageClick:i,handleInfoClick:c}:{}},ge={answer:"Answer",article:"Column",zvideo:"Zvideo",question:"Question",collection:"Collection",roundtable:"Roundtable",topic:"Topic"},he=w.forwardRef((function(t,e){var n=D()(t,["zvideoLinkCardProps"]),o=n.inEditor,r=n["data-text"],i=n.href,c=n.zaBlock,l=m()(n,lt),u=(0,w.useRef)(),d=function(t){var e=(0,w.useRef)(0),n=t.inEditor,o=t["data-offset-key"],r=t["data-text"],i=t["data-image"],c=t.href,l=(0,w.useRef)(!1),u=(0,w.useRef)(c),d="draftjs"===n,f=(0,w.useState)((function(){return d&&de[o]||null})),g=ht(y(),f,2),h=g[0],m=g[1],p=(0,G.Z)({once:!0}),v=ht(y(),p,2),b=v[0],A=v[1],k=(0,z.Z)((function(t){var e=t||h;if(!e||0===Object.keys(e).length)return{objectType:null,title:r||c,thumbnail:i};e.title=r||e.title||c,e.thumbnail=i||e.thumbnail;var n=Object.assign(Object.assign({},e),{},{cached:!0});return d&&(de[o]=n),n})),C=(0,z.Z)(le()),x=(0,z.Z)(s()(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.current+=1,t.prev=1,t.next=4,C(ue(),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"},dataBuilder:function(t){return t.urls="".concat(t.urls?t.urls+",":"").concat(c),t},resultBuilder:function(t){return t[c]}});case 4:n=t.sent,m(k(n)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e.current<=1?x():m(k());case 11:case"end":return t.stop()}}),t,null,[[1,8]])}))));return(0,w.useEffect)((function(){(!A||h&&h.cached)&&u.current===c||x()}),[A,h,x,c]),(0,w.useEffect)((function(){n&&l.current&&m(k(u.current!==c?{title:r}:null))}),[n,k,r,c]),(0,w.useEffect)((function(){u.current=c}),[c]),(0,w.useEffect)((function(){l.current=!0}),[]),[b,h]}(t),f=ht(y(),d,2),g=f[0],h=f[1],p=fe(t,u,"zvideo"===(null==h?void 0:h.objectType)),v=p.handleImageClick,b=p.handleInfoClick,A=(0,w.useCallback)(mt(e,g,u),[]),k=o?Vt:L.$U,C=o?null:{as:Vt,shouldTrackShow:!0,zaText:!0,zaType:"Button",zaAction:"OpenUrl",zaBlock:c,extra:{link:{url:i}},"data-za-module":"Content"},x=(0,Z.tZ)(k,Object.assign(Object.assign({},C),{},{url:i,data:h,onClick:b,onClickImage:v}));return(0,Z.tZ)(Tt,Object.assign(Object.assign({ref:A,text:r,url:i,component:"a"},l),{},{children:Boolean(h)&&(0,Z.tZ)(L.eV,{content:{type:ge[h.objectType]||"Unknown"},children:x})}))})),me=function(t){return function(e){var n=(0,w.useState)(null),o=ht(y(),n,2),r=o[0],a=o[1],i=t.idAttr,c=t.selector,l=t.component,s=t.targetClassName,u=t.cardDataFilter,d=t.getCardProps,f=e.root,g=m()(e,st),h=i&&c&&s&&(0,w.useCallback)((function(t){return function(t){var e=t.idAttr,n=t.targetClassName;return function(t){var o=t.getAttribute(e),r=document.createElement("div");return r.className=n,t.parentNode.replaceChild(r,t),{data:{id:o},target:r}}}({idAttr:i,targetClassName:s})(t)}),[i,s]),p=(0,w.useMemo)((function(){return h?function(t){return Array.from(t.querySelectorAll(c)).map(h)}:x()}),[h,f,c]);return(0,w.useEffect)((function(){if(f||c&&u){var t=(u||p)(f).map((function(t){var e=t.data,n=t.target,o=null;return"function"==typeof d&&(o=d(e)),(0,J.createPortal)((0,Z.tZ)(l,Object.assign(Object.assign({id:e.id},o),g),e.id),n)}));t.length>0&&a(t)}}),[f]),r}},pe=me({cardDataFilter:function(t){return Array.from(t.querySelectorAll("a.LinkCard[data-draft-type=link-card]:not([data-is-ecommerce])")).map((function(t){var e,n=(e=t.attributes,Array.from(e).reduce((function(t,e){return"class"===e.name?t.className=e.value:t[e.name]=e.value,t}),{})),o=document.createElement("div");return o.className="RichText-LinkCardContainer",t.parentNode.replaceChild(o,t),{data:n,target:o}}))},getCardProps:function(t){return t.href&&t.href.match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/)?t.zaBlock="ZTextZVideoLinkCard":t.zaBlock="ZTextLinkCard",t},component:he}),ve=function(t){return{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,borderRadius:"inherit",height:80,boxSizing:"border-box",background:t.colorMod(t.colors.GBK10A).alpha(.88),color:t.colors.GBK08A}},be=function(t){return{width:60,height:60,background:t.colors.GBK09A,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,marginRight:10}},Ae=function(t){return{height:60,flex:1,display:"flex",flexDirection:"column",span:{height:16,display:"inline-block",background:t.colors.GBK09A},"span:nth-of-type(1)":{width:60,marginBottom:4},"span:nth-of-type(2)":{width:127}}},ke=function(t){return{".LinkCard.old":{position:"relative",display:"block",margin:"1em auto",width:390,boxSizing:"border-box",borderRadius:12,maxWidth:"100%",overflow:"hidden","&,&:hover":{textDecoration:"none",border:"none !important",color:"inherit !important"}},".LinkCard-ecommerceLoadingCard":ve(t),".LinkCard-ecommerceLoadingCardAvatarWrapper":be(t),".LinkCard-ecommerceLoadingCardNetwork":{width:20,height:20},".LinkCard-ecommerceLoadingCardLoadingbar":Ae(t)}},ye=function(t){return{position:"relative",display:"flex",boxSizing:"border-box",flexDirection:"row",alignItems:"center",width:390,minHeight:84,borderRadius:8,maxWidth:"100%",overflow:"hidden",margin:"16px auto",padding:"12px 12px 9px 12px",backgroundColor:t.colors.GBK10A,"&, &:hover":{textDecoration:"none",border:"none !important",color:"inherit !important"},".LinkCard-contents":{display:"block",flex:"1 1 auto",position:"relative",".loading":{height:14,background:t.colors.GBK09A,borderRadius:7},"&.withTitle":{marginBottom:3}},".LinkCard-title":Object.assign(Object.assign({display:"block",fontSize:15,fontWeight:500,lineHeight:1.4,marginBottom:2,color:t.colors.GBK02A},(0,$.S)(1)),{},{"&.two-line":Object.assign({lineHeight:"20px"},(0,$.S)(2)),"&.loading":{marginBottom:8,width:"80%","&.withTitle":{marginBottom:6}},"&.loadingTitle":{marginBottom:5}}),".LinkCard-excerpt":Object.assign(Object.assign({display:"block",textOverflow:"ellipsis",fontSize:13,lineHeight:"18px",color:t.colors.GBK06A,marginBottom:4},(0,$.S)(1)),{},{".LinkCard-author":{color:t.colors.GBK03A}}),".LinkCard-desc":Object.assign(Object.assign({display:"block",fontSize:13,height:18,lineHeight:"18px",color:t.colors.GBK06A,wordBreak:"break-all"},(0,$.S)(1)),{},{".LinkCard-tag,.tag":{display:"inline-block",fontSize:11,marginLeft:8,padding:"0 4px",borderRadius:3,background:t.colorMod(t.colors.GBK08A).alpha(.3)},"&.loading":{width:"40%"},svg:{marginRight:2}}),".LinkCard-image":{flex:"0 0 auto",backgroundColor:t.colors.GBK09A,backgroundSize:"cover",backgroundPosition:"center",position:"relative",display:"block",width:60,height:60,marginLeft:20,objectFit:"cover",borderRadius:"inherit",overflow:"hidden","&.LinkCard-image--default":{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t.colors.GBK09A,color:t.colors.GBK08A,svg:{color:t.colors.GBK06A}},img:{width:"100%",height:"100%",objectFit:"cover"},".LinkCard-image--video":{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",width:24,height:24,borderRadius:12,background:t.colorMod(t.colors.GBK99C).alpha(.9),pointerEvents:"none",svg:{color:t.colors.GBK03A}}},".LinkCard-richText":{".text":{color:t.colors.GBK03A},".bold":{fontWeight:t.fontWeights.bold},".tag":{marginLeft:4}}}},we=function(t){return{".LinkCard.new":ye(t)}},Ce=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(t,Object.assign({credentials:"include",headers:{"X-Requested-With":"Fetch"}},e)).then((function(t){return t.json()}))},xe=function(t){return Object.assign(Object.assign({},ke(t)),we(t))},Be=function(t){return Object.assign(Object.assign({},we(t)),ke(t))},Le=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.rootMargin,r=n.threshold,a=n.once,i=void 0===a||a;t=Array.isArray(t)?t:t?[t]:[];var c=(0,w.useRef)(null),l=(0,z.Z)(e);(0,w.useEffect)((function(){if(t.length)return c.current&&t.forEach((function(t){return c.current.unobserve(t)})),c.current=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&(l(t),i&&c.current.unobserve(t.target))}))}),{rootMargin:o,threshold:r}),t.forEach((function(t){return c.current.observe(t)})),function(){t.forEach((function(t){return c.current.unobserve(t)}))}}),[t,o,JSON.stringify(r),i])},ze=n(76745);var Ge="function"==typeof Image,Se={},Ze=Ge?ze((function(t){return new Promise((function(e){return n=t,o=function(t,n){Se[t]=n,e(n)},(r=new Image).onload=function(){var t=r.width>0&&r.height>0;o(n,t)},r.onerror=function(){o(n,!1)},void(r.src="data:image/webp;base64,"+{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"}[n]);var n,o,r}))})):function(){return Promise.resolve(!1)},Oe=function(t){var e=Se[t],n=(0,w.useState)(e),o=ht(y(),n,2),r=o[0],a=o[1];return Ge&&void 0===e&&Ze(t).then(a),r},Re={class:"className"},je=(0,w.forwardRef)((function(t,e){var n=t.node,o=t.tagName,r=m()(t,ut),a=(0,w.useMemo)((function(){return function(t){return Array.from(t.attributes).reduce((function(t,e){var n=Re[e.name]||e.name;return"style"!==n&&(t[n]=e.value),t}),{})}(n)}),[n]);return(0,w.createElement)(o||n.tagName.toLowerCase(),Object.assign(Object.assign(Object.assign({},a),r),{},{ref:e}))})),Ie=et()((function(){return/Mobile/.test(navigator.userAgent)}));function Te(t,e){var n={monitor:{type:"Event",imgResourceErrorInfo:{error_description:e,img_url:t,img_from:"web"}}};B.Z.trackMonitor({name:e},n)}var We=function(t){var e=t.onLoadStateChange,n=t.enableWebP,o=t.size,r=t.quality;return function(t){var a=t.target,i=function(t){var e=t.image,n=t.enableWebP,o=t.size,r=t.quality,a=void 0===r?80:r,i=e.dataset,c=i.actualsrc,l=i.actualgif;return n&&l&&l.match(/.gif$/i)?c:(o||(o="720w",!Ie()&&window.devicePixelRatio>=1.5&&(o="1440w"),Ie()&&window.devicePixelRatio*window.innerWidth>=1080&&(o="1440w")),(0,N.imgUrl)(c,{quality:a,size:o}))}({image:a,enableWebP:n,size:o,quality:r});if(n&&(i=function(t){return t.replace(/\.(jpg|png|jpeg|gif)/,".webp")}(i)),a.dataset.rawheight&&!a.getAttribute("height")&&a.setAttribute("height",a.dataset.rawheight),a.src=i,a.complete)a.dataset.lazyStatus="ok";else{e&&a.addEventListener("loadstart",(function(){e("loadstart",i)})),a.dataset.lazyStatus="loading";var c=setTimeout((function(){a.complete||Te(a.url,"image_web_timeout_image"),e&&e("timeout",i)}),15e3);a.addEventListener("load",(function(){a.dataset.lazyStatus="ok",clearTimeout(c),Te(a.url,"image_web_success_image"),e&&e("load",i)})),a.addEventListener("error",(function(){clearTimeout(c),Te(a.url,"image_web_fail_image"),e&&e("error",i)}))}}},Ee=function(t){var e=t.node,n=t.useWebP,o=void 0===n||n,r=t.onLoadStateChange,a=t.size,i=t.quality,c=e.classList.contains("lazy"),l=Oe("lossless"),s=(0,G.Z)({once:!0,rootMargin:"600px"}),u=ht(y(),s,3),d=u[0],f=u[1],g=u[2],h=(0,z.Z)(We({onLoadStateChange:r,enableWebP:l&&o,size:a,quality:i}));return(0,w.useEffect)((function(){f&&h(g)}),[g,f,h]),(0,Z.tZ)(je,{node:e,ref:c?d:void 0})},De=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.useWebP,o=void 0===n||n,r=e.disabled,a=void 0!==r&&r,i=e.onLoadStateChange,c=e.size,l=e.quality,s=(0,w.useState)([]),u=ht(y(),s,2),d=u[0],f=u[1],g=Oe("lossless");Le(d,We({onLoadStateChange:i,enableWebP:g&&o,size:c,quality:l}),{rootMargin:"300px"}),(0,w.useEffect)((function(){if(t&&!a){var e=Array.from(t.querySelectorAll("img.lazy:not([data-thumbnail])"));e.length&&f(e)}}),[t,a])},Ne=function(t){var e=t.root,n=t.options;return De(e,n),null},Pe=function(t,e){B.Z.trackEvent(t,{action:"StatusReport",element:"Card"},{status:{result:e}})},Ke=function(t,e){var n,o,r;null===(n=window)||void 0===n||null===(o=n.Raven)||void 0===o||null===(r=o.captureException)||void 0===r||r.call(o,t,{fingerprint:["gif2mp4"],extra:e})},Me=function(t){var e=t.src,n=t.useWebP,o=void 0===n?"auto":n,r=t.useMp4,a=void 0!==r&&r,i=t.onRef,c=t.onLoadStateChange,l=m()(t,dt),s=(0,w.useState)(""),u=ht(y(),s,2),d=u[0],f=u[1],g=(0,w.useState)(null),h=ht(y(),g,2),p=h[0],v=h[1],b=(0,w.useState)(Date.now()),A=ht(y(),b,2),k=A[0],C=A[1],L=(0,w.useState)(!1),z=ht(y(),L,2),G=z[0],O=z[1],R=(0,w.useState)(null),j=ht(y(),R,2),I=j[0],T=j[1],W=Oe("animation"),E=(0,w.useCallback)((function(){var t=((0,nt.imgPathParse)(e)||{}).hash;a&&(0,Y.y3)(p,(function(){var e;(e=t,fetch("https://api.zhihu.com/gif2mp4/".concat(e),{credentials:"include",headers:{"X-Requested-With":"Fetch"}}).then((function(t){return t.json()}))).then((function(t){var e,n,o=t.playlist,r=(null==o||null===(e=o.SD)||void 0===e?void 0:e.play_url)||(null==o||null===(n=o.LD)||void 0===n?void 0:n.play_url);r&&ot.ZP.increment("Gif2Mp4Player.mp4.fetch.success.count"),f(r)})).catch(x())}))}),[p,e,a]);(0,w.useEffect)(E,[e,a,p]),(0,w.useEffect)((function(){p&&B.Z.setModule(p,{module:"GifItem"})}),[p]),Le(p,(function(){B.Z.trackCardShow(p,{element:"Card"})})),(0,S.Z)((function(){ot.ZP.increment("Gif2Mp4Player.mp4.play.failure.count"),Ke(new Error("Gif2Mp4 play timeout"),{src:e,videoUrl:d}),O(!1)}),G?2e3:null),(0,S.Z)((function(){ot.ZP.increment("Gif2Mp4Player.mp4.play.success.count"),ot.ZP.timing("Gif2Mp4Player.mp4.first_frame_time",Date.now()-k-100),O(!1),T(null)}),I);var D=(0,nt.default)(e,{extension:("auto"===o?W:o)?"webp":"gif"});return(0,Z.tZ)(at.ZP,Object.assign({videoUrl:d,src:D,onRef:(0,w.useCallback)(mt(i,v),[]),onPlayChange:function(t){t||(C(Date.now()),d&&(ot.ZP.increment("Gif2Mp4Player.mp4.click.count"),O(!0)),B.Z.trackEvent(p,{action:"Click",element:"Image"}))},onLoadStart:function(){if(d){var t=rt.parse(d).expiration;t&&Number(t)<Date.now()/1e3+900&&E()}C(Date.now()),c&&c("loadstart",D)},onSuccess:function(){Pe(p,"Success"),d?G&&T(100):ot.ZP.timing("Gif2Mp4Player.gif.first_frame_time",Date.now()-k),c&&c("load",D)},onFailed:function(t){Pe(p,"Fail"),d&&(G&&(ot.ZP.increment("Gif2Mp4Player.mp4.play.failure.count"),O(!1),T(null)),Ke(t,{videoUrl:d,src:e})),c&&c("error",D)}},l))},_e=function(t){var e=t.node,n=t.Component,o=void 0===n?Me:n,r=(0,w.useMemo)((function(){return function(t){var e=t.dataset,n=e.thumbnail;return{src:n,poster:n,size:e.size}}(e)}),[e]);return(0,Z.tZ)(o,Object.assign({},r))},Ve=function(t){return function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).Component,n=void 0===e?Me:e,o=(0,w.useState)(null),r=ht(y(),o,2),a=r[0],i=r[1];return(0,w.useEffect)((function(){if(t){var e=Array.from(t.querySelectorAll("img.origin_image[data-thumbnail],img.content_image[data-thumbnail]"));if(e.length){var o=e.map((function(t,e){var o=document.createElement("div");return o.className="RichText-gifPlaceholder",t.parentNode.replaceChild(o,t),(0,J.createPortal)((0,Z.tZ)(_e,{node:t,Component:n},e),o)}));i(o)}}}),[t]),a}(t.root,t.options)},qe=function(t){var e=t.root,n=t.ConditionalImage,o=(0,w.useState)([]),r=ht(y(),o,2),a=r[0],i=r[1];return(0,w.useEffect)((function(){if(e){var t=Array.from(e.querySelectorAll("img.origin_image,img.content_image"));if(t.length){var o=t.map((function(t,e){var o=document.createElement("div");return t.parentNode.replaceChild(o,t),(0,J.createPortal)((0,Z.tZ)(n,{node:t},e),o)}));i(o)}}}),[e]),a},Ue=pt([function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.linkCardInfo;return t?t.replace(ne,(function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Xt(e,{decodeValue:!0}),a=r.target,i=void 0===a?"_blank":a,c=r.href,l=void 0===c?"":c,s=r["data-image"],u=r["data-image-width"],d=r["data-image-height"],f=r["data-entity-type"],g=r["data-entity-data"],h=r["data-size"],m=r["data-is-ecommerce"];if(m)return t;var p=o.replace(/<[^>]*>/g,"");p=Jt(p),l.match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/)&&!p&&(p="知乎视频");var v=n?Qt:Tt;return(0,W.renderToStaticMarkup)((0,Z.tZ)(v,Object.assign({text:p,url:l,target:i,image:s,imageWidth:u,imageHeight:d,entityType:f,entityData:Yt(g),size:h},n&&{data:n[l]})))})):t},function(t){return t?t.replace(re,(function(t,e){var n=Xt(e,{decodeValue:!0}),o=n["data-draft-type"],r=n.href,a=n.class;return"link-card"!==o?t:(0,W.renderToStaticMarkup)((0,Z.tZ)(oe,{url:r,className:H()(a,{old:!0,new:!1,static:!1})}))})):t}]),He=(0,w.forwardRef)((function(t,e){var n=(0,w.useState)(null),o=ht(y(),n,2),r=o[0],a=o[1],i=t.html,c=t.css,l=t.options,s=void 0===l?{}:l,u=t.ConditionalImage,d=t.linkCardInfo,f=m()(t,ft),g=s.lazyLoadImageOptions,h=s.useGifPortalOption,p=m()(s,gt);bt(r);var v=[xe,Be,c].reduce((function(t,e){return e||(e={}),"function"==typeof e?function(n){return Object.assign(Object.assign({},t(n)),e(n))}:function(n){return Object.assign(Object.assign({},t(n)),e)}}),(function(t){return{}})),b=(0,w.useCallback)(mt(e,a),[]);return(0,Z.BX)(w.Fragment,{children:[!d&&(0,Z.tZ)(pe,{css:Be,root:r}),u?(0,Z.tZ)(qe,{root:r,ConditionalImage:u}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Ne,{root:r,options:g}),(0,Z.tZ)(Ve,{root:r,options:h})]}),(0,Z.tZ)(Ct,{root:r}),(0,Z.tZ)(It,Object.assign({ref:b,html:Ue(i,{linkCardInfo:d}),css:v,root:r,options:p},f))]})})),Qe=/<sup\b([^>]*data-draft-type="reference"[^>]*)>(.*?)<\/sup>/g}}]);
//# sourceMappingURL=lib-0e5ce61e.app.04627552afda3b578ffb.js.map